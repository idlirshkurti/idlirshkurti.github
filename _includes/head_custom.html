{% case page.math %}
  {% when "mathjax3" %}
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          tags: 'ams',
          packages: {'[+]': ['textmacros']}
        },
        loader: {
          load: ['[tex]/textmacros']
        },
        options: {
          renderActions: {
            findScript: [10, function (doc) {
              // Add this line to ensure MathJax finds the script elements
              doc.scriptMap = {};
            }, '']
          }
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
    </script>
{% endcase %}
